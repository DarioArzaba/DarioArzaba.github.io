---
layout: post_page
title: PGN Spec
---

PGN o Portable Game Notation es un tipo de archivo usado para representar partidas de ajedrez en forma de texto ASCII. Es facil de entender y editar, tanto por humanos como por computadoras. Fue creado para ser importando, procesado y exportado rapidamente por cualquier software de ajedrez y para un uso general a diferencia de otros formatos adapatados a usos especificos. Para poder ver y editar PGN podemos utilizar el editor de Chess.com: [Analysis Board Editor](https://www.chess.com/analysis-board-editor)

Para incluir tableros interactivos de ajedrez en mi [Blog General](thehearthofdev.x10.mx/Ajedrez/Ajedrez.html) utilice IFrames y este [Generador de Diagramas](http://pgn4web-board.casaschi.net/board-generator.html). Usando notacion PGN y un [Script](https://sourceforge.net/p/pgn4web/wiki/Index/) JavaScript el generador me otorga este codigo que puedo incluir en mis archivos HTML.

```
<iframe height='300' width='214' sandbox="allow-scripts" src='http://pgn4web-board.casaschi.net/?am=n&amp;d=2000&amp;ss=26&amp;ps=d&amp;pf=d&amp;lcs=_XNo&amp;dcs=O8AB&amp;bbcs=O8AB&amp;bscs=b&amp;hm=n&amp;hcs=r4fT&amp;bd=s&amp;cbcs=YeiP&amp;ctcs=$$$$&amp;hd=h&amp;md=t&amp;tm=13&amp;fmcs=$$$&amp;fccs=v71$&amp;hmcs=_XNo&amp;fms=11&amp;fcs=m&amp;cd=i&amp;bcs=____&amp;fp=0&amp;hl=f&amp;fh=320&amp;fw=214&amp;
pe=103$zlax9RvfEG8ovpM739pNgYVM739pNmuAVJT39pNmXX5Hh01BHz4AVvs$wilhVgZKNI$wila2$8x1pw$0zBfcizb$3QF7O_v0
'>No disponible</iframe>
\\Notece que la unica parte que cambia es la variable (PE).
```

Creado en 1993 por [Steven J. Edwards](https://chessprogramming.wikispaces.com/Steven+Edwards), el formato fue muy importante al inicio del internet ya que permitio compartir partidas de ajedrez de forma eficaz y utilizando poco espacio de almacenamiento. Una de sus principales caracteristicas es su portabilidad permitiendo almacenar cientos de partidas (Base de Datos de Ajedrez) en un unico archivo y ocupar poco espacio.

Segun la [especificacion](http://www.saremba.de/chessgml/standards/pgn/pgn-complete.htm), existen dos modalidades de PGN, el de *importacion* y el de *exportacion*. En el modo de importacion el archivo es editado y visualizado por humanos usando una sitaxis flexible, en el de exportacion el archivo es procesado por programas usando una sintaxis muy estricta la cual se detalla a continuacion.

El archivo inicia con un par de atributos o *etiquetas* y sus valores entre corchetes `[Atributo "Valor"]`. En exportacion se requieren forzozamente siete atributos estandar o SRT (Seven Tag Roster):

1. **Event**: Nombre del evento.
2. **Site**: Lugar del evento como (Ciudad,Region Pais). El pais en codigo de tres letras segun el IOC.
3. **Date**: Fecha de inicio del juego como (YYYY.MM.DD).
4. **Round**: Ronda del juego en un torneo.
5. **White**: Nombre del jugador o programa de las blancas como (Apellido, Nombre) o (Aplicacion Version).
6. **Black**: Nombre del jugador o programa de las negras como (Apellido, Nombre) o (Aplicacion Version).
7. **Result**: Resultado de la partida. Solo se permiten cuatro valores 1-0, 0-1, 1/2-1/2 o \*, en donde el asterisco simboliza que se desconoce el resultado.

Etiquetas Opcionales:

1. Annotator: Nombre de la persona que comento o edito el juego.
2. PlyCount: Numero total de movimientos jugados.
3. TimeControl: Tiempo de Control utilizado como (Movimientos/Segundos:TiempoExtra).
4. Time: Hora local cuando inicio el juego como (HH:MM:SS).
5. Termination: Describe las circunstancias por las que termino el juego (Abandoned, adjudication, death, emergency, normal, rules infraction, time forfeit o undeterminated).
6. Mode: Describe la modalidad de ajedrez utilizada como OTB (Over the Board), ICS (Internet Chess Server), PM (Paper Mail), EM (Electronic Mail), TC (General Telecommunication) etc.
7. FEN: Describe la posicion inicial de las piezas utilizando Forsyth Edwards Notation. Esta etiqueta debe de ir acompa√±ada de una etiqueta SetUp cuyo valor sea igual a (1).
8. Variant: Especifica una variacion de ajedrez como Chess960.
9. ECO: Especifica la apertura ECO utilizada en la partida como (xdd) o (xdd/dd) en donde (x) es una letra (A-E) y en donde (d) son los digitos de la apertura.
10. NIC: Especifica la apertura segun la *New Chess Database*

Si no se conoce el valor de una etiqueta se utilizan signos de interrogacion (?) y si el valor no existe o no aplica se utiliza un guion simple (-). Despues de las etiquetas se agrega la seccion que contiene los movimientos del juego denominada *Movetext*. Los movimientos se escriben en notacion SAN (Standard Algebraic Notation), numerando cada turno con un numero, un punto y un espacio. En el caso de que sea el turno de las negras se utilizan tres puntos para representar al de las blancas.

Podemos agregar comentarios genericos usando la notacion [NAG](https://en.wikipedia.org/wiki/Numeric_Annotation_Glyphs) (Numeric Annotation Glyphs), los codigos NAG se separan con un espacio del movimiento a comentar e inician con un signo de dolares ($) seguido de un integral positivo (0-255). Para agregar comentarios especificos a un movimiento utilizamos llaves ({}).

Se define una nueva linea como su equivalente en ASCII al decimal 10 o al hexadecimal 0x0a. Los programas tienen permitido eliminar comentarios, limitarse a las siete etiquetas, eliminar variaciones y comentarios NAG para producir un *Formato de Exportacion Reducido*. Todo archivo debe utilizar el set de caracteres ISO 8859/1 (Latin 1), tambien denominado ECMA-94. Este set de caracteres incluye todos los valores ASCII. Solo se admiten dos caracteres de control: Nueva linea y retorno de carro. Se utiliza un simbolo de porcentaje (%) para escapar caracteres especiales los cuales pueden ser ignorados o aprovechados como comandos adicionales dependiendo del programa.

Se utilizan parentesis para delimitar Variaciones Recursivas o RAV (Recursive Annotation Variation). Una variacion recursiva ignora el ultimo movimiento y lo sustituye por una linea de movimientos alterantivos.

```
{Partida PGN de Ejemplo}

[Event "F/S Return Match"]
[Site "Belgrade, Serbia JUG"]
[Date "1992.11.04"]
[Round "29"]
[White "Fischer, Robert J."]
[Black "Spassky, Boris V."]
[Result "1/2-1/2"]

1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 {This opening is called the Ruy Lopez.}
4. Ba4 Nf6 5. O-O Be7 6. Re1 b5 7. Bb3 d6 8. c3 O-O 9. h3 Nb8 10. d4 Nbd7
11. c4 c6 12. cxb5 axb5 13. Nc3 Bb7 14. Bg5 b4 15. Nb1 h6 16. Bh4 c5 17. dxe5
Nxe4 18. Bxe7 Qxe7 19. exd6 Qf6 20. Nbd2 Nxd6 21. Nc4 Nxc4 22. Bxc4 Nb6
23. Ne5 Rae8 24. Bxf7+ Rxf7 25. Nxf7 Rxe1+ 26. Qxe1 Kxf7 27. Qe3 Qg5 28. Qxg5
hxg5 29. b3 Ke6 30. a3 Kd6 31. axb4 cxb4 32. Ra5 Nd5 33. f3 Bc8 34. Kf2 Bf5
35. Ra7 g6 36. Ra6+ Kc5 37. Ke1 Nf4 38. g3 Nxh3 39. Kd2 Kb5 40. Rd6 Kc5 41. Ra6
Nf2 42. g4 Bd3 43. Re6 1/2-1/2
```

******************************

**FEN**: Forsyth Edwards Notation es una notacion desarrollada por [Scotsman David Forsyth](https://en.wikipedia.org/wiki/David_Forsyth_(chess_player)) y [modernizada](https://sourceforge.net/projects/sankit/) por Steven Edwards para describr el estado del tablero y la posicion de todas las piezas en un momento dado. En un archivo PGN se utiliza para indicar la posicion inicial de las piezas antes del primer movimiento y esta compuesta por seis secciones:

1. Representa el lugar de las piezas en el tablero. Se cuentan las casillas desde la fila (8) a la (1) y de la columna (a) a la (h), de haber una pieza ocupando la casilla se representa con mayusculas para las blancas (PNBRQK) y con minusculas para las negras (pnbrqk). Se utilizan numeros para indicar una serie horizontal de casillas vacias y cada nueva fila se separa con un slash (/).
2. Indica si las blancas (w) o las negras (b) tienen el turno siguiente.
3. Indica si el enroque esta bloqueado por una pieza enemiga. Para las blancas por el flanco del rey (K) o por el de la reina (Q) y para las negras por el flanco del rey (k) o por el de la reina (q). Si ninguno puede hacer enroque se coloca un guion (-).
4. Indica la casilla (Columna-Fila) en donde *seria* posible realizar una captura al paso, si no hay capturas al paso se coloca un guion (-).
5. Numero integral positivo que indica el numero de movimientos (Ply) desde la ultima captura o movimiento con los peones, se utiliza para mantener control de la regla de cincuenta movimientos.
6. Numero integral positivo que indica el turno activo de la partida, en dode cada turno esta compuesto por dos movimientos (Ply).

```
{FEN de la posicion inicial}
rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1
{FEN en donde solo quedan los Reyes y un peon en e2}
4k3/8/8/8/8/8/4P3/4K3 w - - 5 39
```

**EPD**: [Extended Position Description](http://jchecs.free.fr/pdf/EPDSpecification.pdf) es una notacion desarrollada por John Stanback y Steven Edwards para el programa de ajedrez *Zarkov* el cual nos permite describir posiciones de ajedrez con una serie de atributos adicionales a la notacion FEN. Utiliza las primeras cuatro secciones del FEN sumando despues comandos adicionales. Un comando adicional EPD esta compuesto por un *Opcode* seguido de operandos especificos del Opcode los cuales concluyen con un punto y coma. 

La representacion binaria de un archivo PGN es un PGC (PGN Game Coding). Se utilizaba antiguamente para obtener la mayor eficiencia posible en procesamiento y almacenaje, sin embargo evitaban casi por completo su edicion por lo que no se popularizo.

El uso de tableros DGT para la transmision en vivo de las partidas de ajedrez no esta incluido en la especificacion PGN y para poder introducir variables de tiempo se ha propuesto incluir marcas de tiempo dentro de comentarios utilizando el simbolo de escape. ` {Comentario [%clk 1:05:23] Otro Comentario} `.

En el caso de utilizar dichas marcas de tiempo sera necesario incluir la etiqueta de *TimeControl* para que el software relacione el calculo de las marcas al tiempo total de la partida. Tambien notece que dentro de una marca de tiempo las variables de tiempo se separan con dobles puntos mientras que valores adicionales se separan con comas. `[%Comando 1:45:12,Nf6,"String Generica"]`

More Info and PGN files: [Portable Game Notation](http://portablegamenotation.com/Description.html)
